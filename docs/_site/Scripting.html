<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

  <title>You wanted customized…</title>
  <meta name="description" content="IMake Zotero effective for us LaTeX holdouts">

<!-- TODO: Create customizable favicon -->
  <!-- favicon -->
  <!-- <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="mask-icon" href="/images/favicon/safari-pinned-tab.svg" color="#3B3535">
  <meta name="msapplication-config" content="/browserconfig.xml">
  <meta name="theme-color" content="#BB2316"> -->

  <!-- MDL styles -->
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue_grey-red.min.css" />

  <!-- Theme Styles -->
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Prism Styles -->
  <link rel="stylesheet" href="assets/css/prism.css">

  <style>
    #view-source {
      position: fixed;
      display: block;
      right: 0;
      bottom: 0;
      margin-right: 40px;
      margin-bottom: 40px;
      z-index: 900;
    }
  </style>
</head>

<body>
  <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <!-- Variable pages to sort pages for navigation -->


<header class="mdl-layout__header mdl-layout__header--waterfall">
  <!-- Top row, always visible -->
  <div class="mdl-layout__header-row eng-navigation-row">
    <!-- Title -->
    <span class="mdl-layout-title"><a class="eng-title-a" href="/">zotero-better-bibtex</a></span>
    <div class="mdl-layout-spacer"></div>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable
  mdl-textfield--floating-label mdl-textfield--align-right">
      <label class="mdl-button mdl-js-button mdl-button--icon" for="waterfall-exp">
  <i class="material-icons">search</i>
  </label>
      <div class="mdl-textfield__expandable-holder">
        <input class="mdl-textfield__input" type="text" name="sample" id="waterfall-exp">
      </div>
    </div>
  </div>
  <!-- Bottom row, not visible on scroll -->
  <div class="mdl-layout__header-row eng-navigation-row">
    <div class="mdl-layout-spacer"></div>
    <!-- Navigation -->
    <nav class="mdl-navigation">
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    </nav>
  </div>
</header>
<div class="mdl-layout__drawer eng-navigation-row">
  <span class="mdl-layout-title"><a class="eng-title-a" href="/">zotero-better-bibtex</a></span>
  <nav class="mdl-navigation">
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  </nav>
</div>

    <script>
  (function(i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
      m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
  })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

ga('create', 'UA-64261422-5', 'auto');
ga('send', 'pageview');

</script>


    <main class="mdl-layout__content">
      <a name="top"></a>
      <div class="mdl-grid eng-wrapper">

  
  <div class="mdl-card__title">
    <h3 class="mdl-card__title-text">You wanted customized…</h3>
  </div>
   

  <div class="mdl-card__supporting-text">
    <h1 id="you-wanted-customized">You wanted customized…</h1>

<p>You got customized. If you go into the Advanced tab of the Better BibTeX preferences you will find a text box (empty by
default) where you can edit a javascript snippet which will be executed for each reference generated in the Bib(La)TeX
exporter. In this code, you have access to the reference just before it will be written out and cached. There is an API
to do this, and it’s fairly stable, but usually you can just open a new issue and ask me to write it, and I’ll add it
here (it’s how the examples got here). Postscripts are available in 4 of the translators:</p>

<ol>
  <li>BetterBibLaTeX</li>
  <li>BetterBibTeX</li>
  <li>BetterCSLJSON</li>
  <li>BetterCSLYAML</li>
</ol>

<p>You can (and totally should) check in which translator your postscript is running, which you can do by testing for
<code class="highlighter-rouge">Translator.&lt;id&gt;</code> where <code class="highlighter-rouge">&lt;id&gt;</code> is one of these four names, using something like</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if (Translator.BetterBibLaTeX) {
  ...
}
</code></pre></div></div>

<p>or alternately on the full name using a switch</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>switch (Translator.header.label) {
  case 'Better BibLaTeX':
    ...
    break;
  case 'Better BibTeX':
    ...
    break;
  case 'Better CSL JSON':
    ...
    break;
  case 'Better CSL YAML':
    ...
    break;
}
</code></pre></div></div>

<p>In the <code class="highlighter-rouge">BetterBib(La)TeX</code> context you will typically access <code class="highlighter-rouge">this</code>, which will
be undefined in the <code class="highlighter-rouge">BetterCSL(JSON|YAML)</code> context. In the <code class="highlighter-rouge">BetterBib(La)TeX</code> context, your Bib(La)TeX reference being built is
available as both <code class="highlighter-rouge">this</code> and <code class="highlighter-rouge">reference</code>; the source Zotero item is available both as <code class="highlighter-rouge">this.item</code> and <code class="highlighter-rouge">item</code>. In the <code class="highlighter-rouge">BetterCSL(JSON|YAML)</code> context,
the CSL object being built is available as <code class="highlighter-rouge">reference</code> and the the source Zotero item is available as <code class="highlighter-rouge">item</code>.</p>

<p>You should
really test for the translator context in your postscripts. If you don’t because you have a postscript that pre-date CSL support, you will probably be using <code class="highlighter-rouge">this.&lt;something&gt;</code> in your
existing postscripts, which will make the script will non-fatally error out. So you’re very probably good to go as-is.
But please fix your postscripts to test for the translator context.</p>

<h2 id="the-api-for-the-better-biblatex-context">The API (for the Better Bib(La)TeX context)</h2>

<p>The postscript should be a <code class="highlighter-rouge">javascript</code> snippet. You can access the data with following objects or functions.</p>

<p>In <code class="highlighter-rouge">BetterBibLaTeX</code> and <code class="highlighter-rouge">BetterBibTeX</code>,</p>

<ul>
  <li><code class="highlighter-rouge">this</code> is the BibTeX reference you are building, and the reference has a number of fields.</li>
  <li><code class="highlighter-rouge">this.fields</code></li>
  <li>
    <p><code class="highlighter-rouge">this.item</code> is the Zotero item that’s the source of the reference.</p>

    <p>e.g. access the date in zotero item <code class="highlighter-rouge">this.item.date</code>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">this.has</code> is a dictionary of fields for output.</p>

    <p>e.g. access the year in output <code class="highlighter-rouge">this.has.year</code></p>
  </li>
  <li>
    <p><code class="highlighter-rouge">this.add</code> is the function to add or modify keys in <code class="highlighter-rouge">this.has</code>. It will check check for unintentional duplicates (unless you specify explicitly with <code class="highlighter-rouge">replace: true</code>).</p>

    <p>e.g. change the value of year in output <code class="highlighter-rouge">this.add({name: 'year', replace: true, value: your_year_value})</code></p>
  </li>
</ul>

<p>In <code class="highlighter-rouge">BetterCSLJSON</code> and <code class="highlighter-rouge">BetterCSLYAML</code>:</p>

<ul>
  <li><code class="highlighter-rouge">reference</code> is the CSL object being built. Any changes made to this object will directly change the CSL object being output.</li>
  <li><code class="highlighter-rouge">item</code> is the Zotero reference it’s being built from.</li>
</ul>

<h2 id="add-accessdate-url-for-bibtex">Add accessdate, url for BibTeX</h2>

<p>Since BibTeX doesn’t really have well-defined behavior across styles the way BibLaTeX does, BBT can’t generate URL data which is compatible with all BibTeX styles. If you know the style you use yourself, you can add the data in the format you want using a postscript. The script below will add a note for the last accessed date, and a <code class="highlighter-rouge">\url</code> tag within the <code class="highlighter-rouge">howpublished</code> field, but only for BibTeX, not for BibLaTeX, and only for <code class="highlighter-rouge">webpage</code> entries:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">Translator</span><span class="p">.</span><span class="nx">BetterBibTeX</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">itemType</span> <span class="o">===</span> <span class="s1">'webpage'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">accessDate</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'note'</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="s2">"(accessed "</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">accessDate</span> <span class="o">+</span> <span class="s2">")"</span> <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'howpublished'</span><span class="p">,</span> <span class="na">bibtex</span><span class="p">:</span> <span class="s2">"{</span><span class="err">\\</span><span class="s2">url{"</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">enc_verbatim</span><span class="p">({</span><span class="na">value</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">url</span><span class="p">})</span> <span class="o">+</span> <span class="s2">"}}"</span> <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>

<h2 id="commas-in-keywords">Comma’s in keywords</h2>

<p>If you want to retain commas in your keywords (e.g. for chemical elements) and separate with a comma-space, you could do:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">Translator</span><span class="p">.</span><span class="nx">BetterBibTeX</span> <span class="o">||</span> <span class="nx">Translator</span><span class="p">.</span><span class="nx">BetterBibLaTeX</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'keywords'</span><span class="p">,</span> <span class="na">replace</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">tags</span><span class="p">,</span> <span class="na">sep</span><span class="p">:</span> <span class="s1">', '</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>as the default encoder knows what to do with arrays, if you give it a separator.</p>

<h2 id="add-doi-in-note-field">Add DOI in note field</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">((</span><span class="nx">Translator</span><span class="p">.</span><span class="nx">BetterBibTeX</span> <span class="o">||</span> <span class="nx">Translator</span><span class="p">.</span><span class="nx">BetterBibLaTeX</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">DOI</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">doi</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">DOI</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doi</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">'doi:'</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doi</span> <span class="o">=</span> <span class="s1">'doi:'</span> <span class="o">+</span> <span class="nx">doi</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'note'</span><span class="p">,</span> <span class="na">duplicate</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="s1">'['</span> <span class="o">+</span> <span class="nx">doi</span> <span class="o">+</span> <span class="s1">']'</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="add-arxiv-data">Add arXiv data</h2>

<p>arXiv is a bit of an odd duck. It really isn’t a journal, so it shouldn’t be the journal title, and their own recommendations on how to include arXiv IDs is a little lacking: <a href="https://arxiv.org/help/faq/references">this</a> doesn’t say where to include the <code class="highlighter-rouge">arXiv:...</code> identfier, and <a href="http://arxiv.org/hypertex/bibstyles/">this</a> says <em>not</em> to include it. Nor does it give any recommendations on how to achieve the <a href="https://arxiv.org/help/faq/references">desired output</a>.</p>

<p>But for arguments’ sake, let’s say you get the desired output by including an empty <code class="highlighter-rouge">journaltitle</code> field (ugh) and stuff the <code class="highlighter-rouge">arXiv:...</code> ID in the <code class="highlighter-rouge">pages</code> field (<em>ugh</em>). You could do that with the following postscript:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if ((Translator.BetterBibTeX || Translator.BetterBibLaTeX) &amp;&amp; this.item.arXiv.id) {
  this.add({ name: 'pages', value: this.item.arXiv.id });
  if (!this.has.journaltitle) { this.add({ name: 'journaltitle', bibtex: '{}' }); }
}
</code></pre></div></div>

<!--
## Custom field order

Specify the ordering of the listing of fields in an exported Biblatex/Bibtex entry. Your postscript:

```javascript
if (Translator.BetterBibTeX || Translator.BetterBibLaTeX) {
  // the bib(la)tex fields are ordered according to this array.
  // If a field is not in this list, it will show up at the end in random order.
  // https://github.com/retorquere/zotero-better-bibtex/issues/512
  var order = ['author', 'date', 'origdate', 'shorthand', 'title'];
  this.fields.sort(function(a, b) {
    var oa = order.indexOf(a.name);
    var ob = order.indexOf(b.name);
    if (oa < 0) { return 1; } // a is not in order, so put it at the end
    if (ob < 0) { return -1; } // b is not in order, so put it at the end
    return oa - ob;
  });
}
```
In Zotero when using an Export Format of Better Biblatex we'll get something like the following entry ...

<pre><code>@book{nietzsche_1974_gay,
  <strong>author</strong> = {Nietzsche, Friedrich Wilhelm},
  <strong>date</strong> = {1974-03},
  <strong>origdate</strong> = {1882},
  <strong>shorthand</strong> = {GS},
  <strong>title</strong> = {The :  a  in  and an  of },
  keywords = {Philosophy / General,Philosophy / History  Surveys / Modern},
  translator = {Kaufmann, Walter},
  publisher = ,
  timestamp = {2016-06-05T20:12:28Z},
  pagetotal = {407},
  shorttitle = {The },
  isbn = {0-394-71985-9},
  edition = {1}
}
</code></pre>

Further details [Export to Biblatex/Bibtex. Custom field order. #512](https://github.com/retorquere/zotero-better-bibtex/issues/512).
-->

  </div>
</div>

    </main>

    <footer class="mdl-mini-footer">
  <div class="mdl-mini-footer__left-section">
    <div class="mdl-logo">zotero-better-bibtex</div>
    <ul class="mdl-mini-footer__link-list">
      <li><a href="#">Help</a></li>
      <li><a href="#">Privacy & Terms</a></li>
    </ul>
  </div>
  <div class="mdl-mini-footer--right-section">
    <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" href="#top" title="back to top" role="button">
      <i class="material-icons md-48" role="presentation">arrow_upward</i>
    </a>
  </div>
</footer>

  </div>
  <!-- Prismjs -->
  <script type="text/javascript" src=/assets/js/prism.min.js>

  </script>
  <!-- MDL Lite js -->
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  <!-- Google Analytics -->
  
</body>
</html>
